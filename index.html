<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Graficador de funciones racionales tipo Mathway</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.8.0/math.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      max-width: 800px;
    }
    input, button {
      padding: 8px;
      margin: 5px;
    }
    #resultado {
      margin-top: 20px;
      font-size: 18px;
    }
    code {
      background: #f2f2f2;
      padding: 2px 5px;
      border-radius: 4px;
    }
  </style>
</head>
<body>
  <h2>Graficador racional estilo Mathway</h2>
  <label>Ingresa una función racional: (ej: (x^2 - 1)/(x^2 - 4))</label><br>
  <input type="text" id="funcionInput" size="40" value="(x^2 - 1)/(x^2 - 4)">
  <button onclick="graficar()">Graficar</button>

  <div id="grafico" style="width: 100%; height: 500px;"></div>
  <div id="resultado"></div>

  <script>
    function graficar() {
      const expr = document.getElementById("funcionInput").value;
      const node = math.parse(expr);
      const compiled = node.compile();

      const x_vals = [];
      const y_vals = [];

      for (let x = -20; x <= 20; x += 0.1) {
        try {
          const y = compiled.evaluate({ x });
          if (Math.abs(y) < 1e5) {
            x_vals.push(x);
            y_vals.push(y);
          } else {
            x_vals.push(NaN);
            y_vals.push(NaN);
          }
        } catch {
          x_vals.push(NaN);
          y_vals.push(NaN);
        }
      }

      // Detección de asíntotas verticales
      const frac = math.simplify(expr);
      const denomMatch = expr.match(/\/\(([^)]+)\)/);
      let asintotasVerticales = [];
      if (denomMatch) {
        const denom = denomMatch[1];
        try {
          const factorizado = math.factor(denom);
          const zeros = math.simplify(`roots(${denom})`).toString();
          const ceros = math.evaluate(`roots(${denom})`);
          asintotasVerticales = Array.isArray(ceros) ? ceros.map(r => math.round(r, 3)) : [];
        } catch {}
      }

      // Estimación del rango
      const y_validos = y_vals.filter(y => !isNaN(y) && isFinite(y));
      const minY = Math.min(...y_validos);
      const maxY = Math.max(...y_validos);

      // Trazar función
      const trace_funcion = {
        x: x_vals,
        y: y_vals,
        mode: 'lines',
        name: 'Función',
        line: { color: 'blue' }
      };

      // Trazar asíntotas verticales
      const trace_asintotas_v = asintotasVerticales.map(x => ({
        x: [x, x],
        y: [-50, 50],
        mode: 'lines',
        name: `x = ${x}`,
        line: { color: 'red', dash: 'dot' },
        showlegend: false
      }));

      // Estimación de asíntota horizontal
      let asintotaH = null;
      try {
        const top = node.args[0]; // numerador
        const bottom = node.args[1]; // denominador
        const gradoTop = math.simplify(top).filter(n => n.isSymbolNode && n.name === 'x').length;
        const gradoBot = math.simplify(bottom).filter(n => n.isSymbolNode && n.name === 'x').length;

        if (gradoTop < gradoBot) asintotaH = 0;
        else if (gradoTop === gradoBot) {
          const lcTop = math.derivative(top, 'x').evaluate({ x: 1 });
          const lcBot = math.derivative(bottom, 'x').evaluate({ x: 1 });
          asintotaH = lcTop / lcBot;
        }
      } catch {}

      const trace_asintota_h = asintotaH !== null ? [{
        x: [-20, 20],
        y: [asintotaH, asintotaH],
        mode: 'lines',
        name: `y = ${asintotaH.toFixed(2)}`,
        line: { color: 'green', dash: 'dot' },
        showlegend: false
      }] : [];

      const layout = {
        title: 'Gráfica de la función',
        xaxis: { title: 'x' },
        yaxis: { title: 'f(x)', range: [-20, 20] }
      };

      Plotly.newPlot('grafico', [trace_funcion, ...trace_asintotas_v, ...trace_asintota_h], layout);

      // Mostrar dominio y rango
      let dominioTexto = `Dominio: x ∈ ℝ`;
      if (asintotasVerticales.length > 0) {
        dominioTexto += `, x ≠ ${asintotasVerticales.join(", ")}`;
      }

      let rangoTexto = `Rango: y ∈ ℝ`;
      if (asintotaH !== null) {
        rangoTexto += `, y ≠ ${asintotaH.toFixed(2)}`;
      }

      document.getElementById("resultado").innerHTML = `
        <strong>${dominioTexto}</strong><br>
        <strong>${rangoTexto}</strong><br><br>
        <strong>Forma simplificada:</strong> <code>${math.simplify(expr).toString()}</code>
      `;
    }

    graficar(); // Por defecto
  </script>
</body>
</html>

